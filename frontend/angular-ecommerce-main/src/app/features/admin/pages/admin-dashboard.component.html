<section class="p-6 space-y-6">
  <h1 class="text-2xl font-semibold">Admin Dashboard</h1>

  <!-- Metrics -->
  <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4">
    <div class="bg-white border rounded-xl p-4">
      <p class="text-sm text-gray-500">Revenue (PAID)</p>
      <div class="mt-3 text-2xl font-semibold">
        {{ revenue | currency:'VND':'symbol':'1.0-0' }}
      </div>
    </div>

    <div class="bg-white border rounded-xl p-4">
      <p class="text-sm text-gray-500">Orders Today</p>
      <div class="mt-3 text-2xl font-semibold">{{ ordersToday }}</div>
    </div>

    <div class="bg-white border rounded-xl p-4">
      <p class="text-sm text-gray-500">Customers Active (7d)</p>
      <div class="mt-3 text-2xl font-semibold">{{ customersActiveWeek }}</div>
    </div>

    <div class="bg-white border rounded-xl p-4">
      <p class="text-sm text-gray-500">Cancellations (30d)</p>
      <div class="mt-3 text-2xl font-semibold">{{ cancellations30d }}</div>
    </div>
  </div>

  <!-- Chart + summary -->
  <div class="grid grid-cols-1 xl:grid-cols-3 gap-4">
    <!-- Sales Overview -->
    <div class="bg-white border rounded-xl p-4 xl:col-span-2">
      <div class="flex items-center justify-between mb-3">
        <h3 class="font-semibold">Sales Overview</h3>

        <!-- Bộ lọc thời gian -->
        <div class="flex items-center gap-2">
          <button class="px-2.5 py-1.5 text-sm rounded border"
                  [class.bg-gray-900]="period==='7d'"
                  [class.text-white]="period==='7d'"
                  (click)="setPeriod('7d')">7 ngày</button>

          <button class="px-2.5 py-1.5 text-sm rounded border"
                  [class.bg-gray-900]="period==='30d'"
                  [class.text-white]="period==='30d'"
                  (click)="setPeriod('30d')">30 ngày</button>

          <button class="px-2.5 py-1.5 text-sm rounded border"
                  [class.bg-gray-900]="period==='90d'"
                  [class.text-white]="period==='90d'"
                  (click)="setPeriod('90d')">Quý</button>

          <button class="px-2.5 py-1.5 text-sm rounded border"
                  [class.bg-gray-900]="period==='12m'"
                  [class.text-white]="period==='12m'"
                  (click)="setPeriod('12m')">Năm</button>
        </div>
      </div>

      <!-- Mixed chart: Bar (revenue) + Line (trend) -->
      <div class="h-[360px]">
        <canvas
          baseChart
          [type]="'bar'"
          [data]="chartData"
          [options]="chartOptions"
        ></canvas>
      </div>
    </div>

    <!-- Payment Summary (Doughnut) -->
    <div class="bg-white border rounded-xl p-4">
      <div class="flex items-center justify-between mb-3">
        <h3 class="font-semibold">Payment Summary</h3>

        <!-- Toggle Count / Amount -->
        <div class="inline-flex rounded overflow-hidden border">
          <button class="px-3 py-1 text-sm"
                  [class.bg-gray-900]="paymentBreakdownMode==='count'"
                  [class.text-white]="paymentBreakdownMode==='count'"
                  (click)="setPaymentMode('count')">Count</button>
          <button class="px-3 py-1 text-sm border-l"
                  [class.bg-gray-900]="paymentBreakdownMode==='amount'"
                  [class.text-white]="paymentBreakdownMode==='amount'"
                  (click)="setPaymentMode('amount')">Amount</button>
        </div>
      </div>

      <!-- Doughnut Chart -->
      <div class="h-[260px]">
        <canvas
          baseChart
          [type]="'doughnut'"
          [data]="paymentSummaryData"
          [options]="paymentSummaryOptions"
        ></canvas>
      </div>

      <!-- Footnotes -->
      <div class="mt-3 text-sm text-gray-600 grid grid-cols-2 gap-2">
        <div>Tổng doanh thu (PAID): <b>{{ revenue | currency:'VND':'symbol':'1.0-0' }}</b></div>
        <div class="text-right">Tổng giao dịch: <b>{{ payments.length }}</b></div>
      </div>
    </div>
  </div>

  <!-- Recent Orders -->
  <div class="bg-white border rounded-xl p-4">
    <div class="flex items-center justify-between mb-3">
      <h3 class="font-semibold">Recent Orders</h3>
      <a class="text-sm text-blue-600 hover:underline" routerLink="/dashboard/orders">View all</a>
    </div>

    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
          <tr class="text-left text-gray-500">
            <th class="py-2 pr-4">ID</th>
            <th class="py-2 pr-4">Customer</th>
            <th class="py-2 pr-4">Date</th>
            <th class="py-2 pr-4">Total</th>
            <th class="py-2">Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let o of recentOrders" class="border-t">
            <td class="py-2 pr-4">#{{ o.id }}</td>
            <td class="py-2 pr-4">{{ o.receiverName || 'Khách' }}</td>
            <td class="py-2 pr-4">{{ o.createdAt | date:'yyyy-MM-dd' }}</td>
            <td class="py-2 pr-4">{{ o.totalAmount | currency:'VND':'symbol' }}</td>
            <td class="py-2">
              <span class="px-2 py-0.5 rounded-full text-xs"
                    [ngClass]="statusBadgeClass(o.status)">
                {{ o.status }}
              </span>
            </td>
          </tr>
          <tr *ngIf="!recentOrders.length" class="border-t">
            <td colspan="5" class="py-2 text-center text-gray-500">No recent orders</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Recent Payments -->
  <div class="bg-white border rounded-xl p-4">
    <h3 class="font-semibold mb-3">Recent Payments</h3>
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
          <tr class="text-left text-gray-500">
            <th class="py-2 pr-4">ID</th>
            <th class="py-2 pr-4">Order ID</th>
            <th class="py-2 pr-4">Date</th>
            <th class="py-2 pr-4">Amount</th>
            <th class="py-2">Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of recentPayments" class="border-t">
            <td class="py-2 pr-4">#{{ p.id }}</td>
            <td class="py-2 pr-4">#{{ p.orderId }}</td>
            <td class="py-2 pr-4">{{ p.createdAt | date:'yyyy-MM-dd' }}</td>
            <td class="py-2 pr-4">{{ p.amount | currency:'VND':'symbol' }}</td>
            <td class="py-2">
              <span class="px-2 py-0.5 rounded-full text-xs"
                    [ngClass]="statusBadgeClass(p.status)">
                {{ p.status }}
              </span>
            </td>
          </tr>
          <tr *ngIf="!recentPayments.length" class="border-t">
            <td colspan="5" class="py-2 text-center text-gray-500">No recent payments</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>
